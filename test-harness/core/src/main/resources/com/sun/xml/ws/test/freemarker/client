#!/bin/bash -ex
# service id: ${serviceId}
# stage: ${stage}
L_STATUS=0

if [ "$failFast" = "true" ]; then
    if [ "$G_STATUS" = "1" ]; then
       return 1
    fi;
fi;

if [ "$skipTests" != "true" ]; then

    TOTAL_STEPS=$((TOTAL_STEPS+1))

    export CTX="${serviceId}:${stage}-client(${testName})"

    . shared

    prolog $CTX

    log "Running ${testName}"

    # to be sure the directory is there (used in classpath ...)
    mkdirp client-classes

    CLIENT_CLASSPATH=${classpath}:$SHARED_LIB

    # compile generated client sources
    compileShared
    compileClientClasses "client-source"
    compileClientClasses "../src/common"
    compileClientClasses "../src/client"

    # copy resources
    if [ -d ../src/resources ]; then
        r cp -rv ../src/resources/* client-classes | true
    fi

    # compile generated bash.Client#.java
    r javac -XDignore.symbol.file -cp $CLIENT_CLASSPATH -d client-classes bsh/${clientClass}${stage}.java bsh/Util.java

    runjava $CLIENT_CLASSPATH bsh.${clientClass}${stage}
fi;

